/*
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package ch.fub.eadp.trino;

import io.airlift.slice.Slice;
import io.airlift.slice.Slices;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.TestInstance;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.Assert.assertEquals;
import static org.junit.jupiter.api.TestInstance.Lifecycle.PER_CLASS;

@TestInstance(PER_CLASS)
public class DdlGenratorFunctionsTest
{
    private static final String NULL_VALUE = "<null>";

    @Test
    public void testValidateSucess()
    {
        String createTableJson = "{\"tableName\":\"flights_0_t\",\"dbName\":\"flight_db\",\"owner\":\"trino\",\"createTime\":1754315973,\"lastAccessTime\":0,\"retention\":0,\"sd\":{\"cols\":[{\"name\":\"dayofmonth\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"dayofweek\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"deptime\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"crsdeptime\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"arrtime\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"crsarrtime\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"uniquecarrier\",\"type\":\"string\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"flightnum\",\"type\":\"string\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"tailnum\",\"type\":\"string\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"actualelapsedtime\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"crselapsedtime\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"airtime\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"arrdelay\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"depdelay\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"origin\",\"type\":\"string\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"destination\",\"type\":\"string\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"distance\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"eventtimestamp\",\"type\":\"timestamp\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false}],\"location\":\"s3a://flight-bucket/refined/flights_0_t\",\"inputFormat\":\"org.apache.hadoop.hive.ql.io.parquet.MapredParquetInputFormat\",\"outputFormat\":\"org.apache.hadoop.hive.ql.io.parquet.MapredParquetOutputFormat\",\"compressed\":false,\"numBuckets\":0,\"serdeInfo\":{\"name\":\"flights_0_t\",\"serializationLib\":\"org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe\",\"parameters\":{},\"description\":null,\"serializerClass\":null,\"deserializerClass\":null,\"serdeType\":null,\"setSerializationLib\":true,\"setDescription\":false,\"setSerializerClass\":false,\"setDeserializerClass\":false,\"setSerdeType\":false,\"setName\":true,\"setParameters\":true,\"parametersSize\":0},\"bucketCols\":null,\"sortCols\":null,\"parameters\":{},\"skewedInfo\":null,\"storedAsSubDirectories\":false,\"colsSize\":18,\"colsIterator\":[{\"name\":\"dayofmonth\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"dayofweek\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"deptime\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"crsdeptime\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"arrtime\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"crsarrtime\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"uniquecarrier\",\"type\":\"string\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"flightnum\",\"type\":\"string\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"tailnum\",\"type\":\"string\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"actualelapsedtime\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"crselapsedtime\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"airtime\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"arrdelay\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"depdelay\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"origin\",\"type\":\"string\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"destination\",\"type\":\"string\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"distance\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"eventtimestamp\",\"type\":\"timestamp\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false}],\"bucketColsSize\":0,\"bucketColsIterator\":null,\"sortColsSize\":0,\"sortColsIterator\":null,\"setCols\":true,\"setLocation\":true,\"setInputFormat\":true,\"setOutputFormat\":true,\"setSerdeInfo\":true,\"setBucketCols\":false,\"setCompressed\":true,\"setNumBuckets\":true,\"setStoredAsSubDirectories\":false,\"setSortCols\":false,\"setSkewedInfo\":false,\"setParameters\":true,\"parametersSize\":0},\"partitionKeys\":[{\"name\":\"year\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"month\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false}],\"parameters\":{\"trino_version\":\"476\",\"totalSize\":\"-1\",\"EXTERNAL\":\"TRUE\",\"numFiles\":\"-1\",\"trino_query_id\":\"20250804_135930_00002_ug6h6\",\"transient_lastDdlTime\":\"1754315973\",\"auto.purge\":\"false\"},\"viewOriginalText\":null,\"viewExpandedText\":null,\"tableType\":\"EXTERNAL_TABLE\",\"privileges\":{\"userPrivileges\":{\"trino\":[{\"privilege\":\"select\",\"createTime\":0,\"grantor\":\"trino\",\"grantorType\":\"USER\",\"grantOption\":true,\"setPrivilege\":true,\"setGrantor\":true,\"setGrantorType\":true,\"setGrantOption\":true,\"setCreateTime\":true},{\"privilege\":\"insert\",\"createTime\":0,\"grantor\":\"trino\",\"grantorType\":\"USER\",\"grantOption\":true,\"setPrivilege\":true,\"setGrantor\":true,\"setGrantorType\":true,\"setGrantOption\":true,\"setCreateTime\":true},{\"privilege\":\"update\",\"createTime\":0,\"grantor\":\"trino\",\"grantorType\":\"USER\",\"grantOption\":true,\"setPrivilege\":true,\"setGrantor\":true,\"setGrantorType\":true,\"setGrantOption\":true,\"setCreateTime\":true},{\"privilege\":\"delete\",\"createTime\":0,\"grantor\":\"trino\",\"grantorType\":\"USER\",\"grantOption\":true,\"setPrivilege\":true,\"setGrantor\":true,\"setGrantorType\":true,\"setGrantOption\":true,\"setCreateTime\":true}]},\"groupPrivileges\":{},\"rolePrivileges\":{},\"setUserPrivileges\":true,\"setGroupPrivileges\":true,\"setRolePrivileges\":true,\"userPrivilegesSize\":1,\"groupPrivilegesSize\":0,\"rolePrivilegesSize\":0},\"temporary\":false,\"rewriteEnabled\":false,\"creationMetadata\":null,\"catName\":\"hive\",\"ownerType\":\"USER\",\"writeId\":-1,\"isStatsCompliant\":false,\"colStats\":null,\"accessType\":0,\"requiredReadCapabilities\":null,\"requiredWriteCapabilities\":null,\"id\":1,\"fileMetadata\":null,\"dictionary\":null,\"txnId\":0,\"setCreateTime\":true,\"setLastAccessTime\":true,\"setRetention\":true,\"setTemporary\":false,\"setRewriteEnabled\":false,\"setWriteId\":false,\"setIsStatsCompliant\":false,\"setAccessType\":false,\"setId\":true,\"setTxnId\":false,\"setTableName\":true,\"setDbName\":true,\"setOwner\":true,\"setSd\":true,\"setPartitionKeys\":true,\"setParameters\":true,\"setViewOriginalText\":false,\"setViewExpandedText\":false,\"setTableType\":true,\"setPrivileges\":true,\"setCreationMetadata\":false,\"setCatName\":true,\"setOwnerType\":true,\"setColStats\":false,\"setRequiredReadCapabilities\":false,\"setRequiredWriteCapabilities\":false,\"setFileMetadata\":false,\"setDictionary\":false,\"partitionKeysSize\":2,\"partitionKeysIterator\":[{\"name\":\"year\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false},{\"name\":\"month\",\"type\":\"int\",\"comment\":null,\"setName\":true,\"setType\":true,\"setComment\":false}],\"parametersSize\":7,\"requiredReadCapabilitiesSize\":0,\"requiredReadCapabilitiesIterator\":null,\"requiredWriteCapabilitiesSize\":0,\"requiredWriteCapabilitiesIterator\":null}";
        Slice sliceValue = Slices.utf8Slice("H4sIAAAAAAAAAF1Q23KDIBD9F55tAFEjfEKe+h46DE1I2BmNFjCdTsZ/76JNO9aXPZzL7hkfJLpwd4EoknyAS1KUeri7l94lG9MQnJKsFaRYfHByrwFuJxhthwlkz+84Lx1cfTKIM3GIww3JhyZcE4UjpoBA/9k0mQtNxD8VOqfohGeWAvTTBucHfNPf3O4ZrdZob0cEx58dxXPyArWEPQfzMbnwZeC8XChZWbOWVYaLWpbSsPyZ6dr4Bte+5cXNttOyZD25XxUQJQKemXbrzaVXq9xY93UleC0bOc/4exL0LibbjxvlGzwTdlWGAQAA");
        String value = DdlGeneratorFunctions.generateDdlFromJson(createTableJson);
        System.out.println(value);
    }
}
